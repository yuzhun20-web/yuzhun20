// same as previous v3 (omitted for brevity in this message, code identical to previous app_js)